@using System.Text.Json
@model TelefonReviewAdminEditorViewModel
@{
    var initialContentJson = JsonSerializer.Serialize(Model.Input.RawContent ?? string.Empty);
}

@section HeadExtras {
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" />
}

<section class="hero" style="padding: var(--space-8) 0;">
    <div class="container">
        <h1 class="hero-title" style="font-size: var(--text-h2);">@Model.PageTitle</h1>
    </div>
</section>

<section class="section" style="padding-top: var(--space-6); padding-bottom: var(--space-8);">
    <div class="container">
        <form method="post" action="/admin/telefon-inceleme/kaydet" style="display: grid; gap: var(--space-4);">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="All" class="text-danger"></div>

            <div>
                <label asp-for="Input.TelefonSlug">Telefon Slug</label>
                <input
                    asp-for="Input.TelefonSlug"
                    class="search-input"
                    list="telefon-slug-list"
                    style="width: 100%; max-width: 520px;"
                    autocomplete="off" />
                <span asp-validation-for="Input.TelefonSlug" class="text-danger"></span>

                <datalist id="telefon-slug-list">
                    @foreach (var phone in Model.PhoneSuggestions)
                    {
                        <option value="@phone.Slug">@phone.Marka @phone.ModelAdi</option>
                    }
                </datalist>
            </div>

            <div>
                <label asp-for="Input.Title">Inceleme Basligi</label>
                <input asp-for="Input.Title" class="search-input" style="width: 100%; max-width: 780px;" />
                <span asp-validation-for="Input.Title" class="text-danger"></span>
            </div>

            <div>
                <label asp-for="Input.Excerpt">Ozet</label>
                <textarea asp-for="Input.Excerpt" class="search-input" rows="3" style="width: 100%; max-width: 780px;"></textarea>
                <span asp-validation-for="Input.Excerpt" class="text-danger"></span>
            </div>

            <div>
                <label for="quill-editor">Inceleme Icerigi</label>
                <div id="quill-editor" style="height: 360px; background: #fff;"></div>
                <input asp-for="Input.RawContent" type="hidden" id="input-raw-content" />
                <span asp-validation-for="Input.RawContent" class="text-danger"></span>
            </div>

            <div>
                <label asp-for="Input.SeoTitle">SEO Title</label>
                <input asp-for="Input.SeoTitle" class="search-input" style="width: 100%; max-width: 780px;" />
                <span asp-validation-for="Input.SeoTitle" class="text-danger"></span>
            </div>

            <div>
                <label asp-for="Input.SeoDescription">SEO Description</label>
                <textarea asp-for="Input.SeoDescription" class="search-input" rows="2" style="width: 100%; max-width: 780px;"></textarea>
                <span asp-validation-for="Input.SeoDescription" class="text-danger"></span>
            </div>

            <div style="display: flex; gap: var(--space-2); flex-wrap: wrap;">
                <button type="submit" class="btn btn-primary">@Model.SubmitLabel</button>
                <a class="btn btn-secondary" href="/admin/telefon-inceleme">Listeye Don</a>
            </div>
        </form>

        @if (Model.IsEditMode)
        {
            <form method="post" action="/admin/telefon-inceleme/sil/@Model.Input.TelefonSlug" style="margin-top: var(--space-4);">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-secondary">Incelemeyi Sil</button>
            </form>
        }
    </div>
</section>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
<script>
(function () {
    const input = document.getElementById('input-raw-content');
    const editorElement = document.getElementById('quill-editor');
    if (!input || !editorElement) {
        return;
    }

    const quill = new Quill(editorElement, {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ list: 'ordered' }, { list: 'bullet' }],
                ['blockquote', 'code-block', 'link'],
                ['clean']
            ]
        }
    });

    const initialContent = @Html.Raw(initialContentJson);
    if (typeof initialContent === 'string' && initialContent.length > 0) {
        quill.root.innerHTML = initialContent;
    }

    const form = editorElement.closest('form');
    if (!form) {
        return;
    }

    form.addEventListener('submit', function () {
        input.value = quill.root.innerHTML;
    });
})();
</script>
}
