@using System.Text.Json
@model BlogAdminEditorViewModel
@{
    var formAction = Model.Id.HasValue ? $"/admin/blog/edit/{Model.Id.Value}" : "/admin/blog/create";
    var initialContentJson = JsonSerializer.Serialize(Model.Input.ContentRaw ?? string.Empty);
    var publishedAtValue = Model.Input.PublishedAt?.ToString("yyyy-MM-ddTHH:mm");
}

@section HeadExtras {
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" />
}

<section class="hero" style="padding: var(--space-8) 0;">
    <div class="container">
        <h1 class="hero-title" style="font-size: var(--text-h2);">@Model.PageTitle</h1>
    </div>
</section>

<section class="section" style="padding-top: var(--space-6); padding-bottom: var(--space-8);">
    <div class="container">
        <form method="post" action="@formAction" style="display: grid; gap: var(--space-4);">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="All" class="text-danger"></div>

            <div>
                <label asp-for="Input.Title">Baslik</label>
                <input asp-for="Input.Title" class="search-input" style="width: 100%; max-width: 780px;" />
                <span asp-validation-for="Input.Title" class="text-danger"></span>
            </div>

            <div>
                <label asp-for="Input.Excerpt">Ozet</label>
                <textarea asp-for="Input.Excerpt" class="search-input" rows="3" style="width: 100%; max-width: 780px;"></textarea>
                <span asp-validation-for="Input.Excerpt" class="text-danger"></span>
            </div>

            <div>
                <label for="quill-editor">Icerik</label>
                <div id="quill-editor" style="height: 360px; background: #fff;"></div>
                <input asp-for="Input.ContentRaw" type="hidden" id="input-content-raw" />
                <span asp-validation-for="Input.ContentRaw" class="text-danger"></span>
            </div>

            <div>
                <label asp-for="Input.MetaTitle">Meta Title</label>
                <input asp-for="Input.MetaTitle" class="search-input" style="width: 100%; max-width: 780px;" />
                <span asp-validation-for="Input.MetaTitle" class="text-danger"></span>
            </div>

            <div>
                <label asp-for="Input.MetaDescription">Meta Description</label>
                <textarea asp-for="Input.MetaDescription" class="search-input" rows="2" style="width: 100%; max-width: 780px;"></textarea>
                <span asp-validation-for="Input.MetaDescription" class="text-danger"></span>
            </div>

            <div style="display: flex; gap: var(--space-4); align-items: center; flex-wrap: wrap;">
                <label style="display: inline-flex; align-items: center; gap: var(--space-2);">
                    <input asp-for="Input.IsPublished" />
                    Yayinda
                </label>

                <div>
                    <label for="Input_PublishedAt">Yayin Tarihi (UTC)</label>
                    <input
                        id="Input_PublishedAt"
                        name="Input.PublishedAt"
                        type="datetime-local"
                        class="search-input"
                        value="@publishedAtValue" />
                    <span asp-validation-for="Input.PublishedAt" class="text-danger"></span>
                </div>
            </div>

            <div style="display: flex; gap: var(--space-2);">
                <button type="submit" class="btn btn-primary">@Model.SubmitLabel</button>
                <a class="btn btn-secondary" href="/admin/blog">Listeye Don</a>
            </div>
        </form>
    </div>
</section>

@section Scripts {
<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
<script>
(function () {
    const input = document.getElementById('input-content-raw');
    const editorElement = document.getElementById('quill-editor');
    if (!input || !editorElement) {
        return;
    }

    const quill = new Quill(editorElement, {
        theme: 'snow',
        modules: {
            toolbar: [
                [{ header: [1, 2, 3, false] }],
                ['bold', 'italic', 'underline', 'strike'],
                [{ list: 'ordered' }, { list: 'bullet' }],
                ['blockquote', 'code-block', 'link'],
                ['clean']
            ]
        }
    });

    const initialContent = @Html.Raw(initialContentJson);
    if (typeof initialContent === 'string' && initialContent.length > 0) {
        quill.root.innerHTML = initialContent;
    }

    const form = editorElement.closest('form');
    if (!form) {
        return;
    }

    form.addEventListener('submit', function () {
        input.value = quill.root.innerHTML;
    });
})();
</script>
}
