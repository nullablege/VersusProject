@model TelefonListViewModel

<section class="hero" style="padding: var(--space-8) 0;">
    <div class="container">
        <h1 class="hero-title" style="font-size: var(--text-h2);">@Model.ListingTitle</h1>
        <p class="hero-subtitle" style="margin-bottom: 0;">@Model.ListingDescription</p>
    </div>
</section>

@if (ViewData["FilterItemListJsonLd"] is string filterItemListJsonLd && !string.IsNullOrWhiteSpace(filterItemListJsonLd))
{
    @section JsonLd {
<script type="application/ld+json">@Html.Raw(filterItemListJsonLd)</script>
    }
}

@if (Model.Brands.Count > 0)
{
    <section class="brands-section" style="padding-top: var(--space-6);">
        <div class="container">
            <div class="section-header">
                <div>
                    <h2 class="section-title">Markalar</h2>
                    <p class="section-subtitle">Marka landing sayfalarina hizli gecis</p>
                </div>
            </div>
            <div class="brands-grid">
                @foreach (var brand in Model.Brands)
                {
                    var brandInitial = string.IsNullOrWhiteSpace(brand.Name) ? "?" : brand.Name[..1].ToUpperInvariant();
                    <a class="brand-item @(brand.IsActive ? "active" : string.Empty)" href="@brand.Url">
                        <div class="brand-logo">@brandInitial</div>
                        <span class="brand-name">@brand.Name</span>
                    </a>
                }
            </div>
        </div>
    </section>
}

@if (!string.IsNullOrWhiteSpace(Model.Brand) && Model.PopularComparisons.Count > 0)
{
    <section class="section" style="padding-top: var(--space-6);">
        <div class="container">
            <div class="section-header">
                <div>
                    <h2 class="section-title">En Populer Karsilastirmalar</h2>
                    <p class="section-subtitle">@Model.Brand modelleri icin onerilen karsilastirmalar</p>
                </div>
            </div>
            <div style="display: flex; flex-wrap: wrap; gap: var(--space-2);">
                @foreach (var compareLink in Model.PopularComparisons)
                {
                    <a class="btn btn-secondary btn-sm" href="@compareLink.Url">@compareLink.Title</a>
                }
            </div>
        </div>
    </section>
}

<section class="section" style="padding-top: var(--space-6);">
    <div class="container">
        @if (Model.Items.Count == 0)
        {
            <p>Listelenecek telefon yok.</p>
        }
        else
        {
            <div class="products-grid">
                @foreach (var phone in Model.Items)
                {
                    var title = string.Join(' ', new[] { phone.Marka, phone.ModelAdi }.Where(x => !string.IsNullOrWhiteSpace(x))).Trim();
                    <article class="product-card">
                        <div class="product-image">
                            <img src="@(string.IsNullOrWhiteSpace(phone.ResimUrl) ? "https://via.placeholder.com/200x300?text=Phone" : phone.ResimUrl)" alt="@title" />
                        </div>
                        <div class="product-info">
                            <p class="product-brand">@phone.Marka</p>
                            <h3 class="product-name">@phone.ModelAdi</h3>
                            <div class="product-specs">
                                @if (!string.IsNullOrWhiteSpace(phone.EkranBoyutu))
                                {
                                    <span class="product-spec">@phone.EkranBoyutu</span>
                                }
                                @if (!string.IsNullOrWhiteSpace(phone.DahiliHafiza))
                                {
                                    <span class="product-spec">@phone.DahiliHafiza</span>
                                }
                                @if (!string.IsNullOrWhiteSpace(phone.AnaKameraModulleri))
                                {
                                    <span class="product-spec">@phone.AnaKameraModulleri</span>
                                }
                            </div>
                            <div class="product-footer">
                                <div class="product-price">@phone.Fiyat</div>
                                @if (!string.IsNullOrWhiteSpace(phone.Slug))
                                {
                                    <a class="btn btn-secondary btn-sm" href="/telefon/@phone.Slug">Detay</a>
                                }
                            </div>
                        </div>
                    </article>
                }
            </div>

            @if (Model.TotalPages > 1)
            {
                var startPage = Math.Max(1, Model.Page - 2);
                var endPage = Math.Min(Model.TotalPages, Model.Page + 2);

                <nav class="pagination" aria-label="Telefon listeleme sayfalari">
                    @if (Model.PrevUrl is null)
                    {
                        <span class="page-btn" aria-disabled="true">Onceki</span>
                    }
                    else
                    {
                        <a class="page-btn" href="@Model.PrevUrl" rel="prev">Onceki</a>
                    }

                    @if (startPage > 1)
                    {
                        <a class="page-btn" href="@Model.BasePath">1</a>
                        @if (startPage > 2)
                        {
                            <span class="page-btn" aria-hidden="true">...</span>
                        }
                    }

                    @for (var pageNumber = startPage; pageNumber <= endPage; pageNumber++)
                    {
                        if (pageNumber == Model.Page)
                        {
                            <span class="page-btn active" aria-current="page">@pageNumber</span>
                        }
                        else
                        {
                            var pageUrl = pageNumber <= 1 ? Model.BasePath : $"{Model.BasePath}?page={pageNumber}";
                            <a class="page-btn" href="@pageUrl">@pageNumber</a>
                        }
                    }

                    @if (endPage < Model.TotalPages)
                    {
                        @if (endPage < Model.TotalPages - 1)
                        {
                            <span class="page-btn" aria-hidden="true">...</span>
                        }
                        var lastPageUrl = $"{Model.BasePath}?page={Model.TotalPages}";
                        <a class="page-btn" href="@lastPageUrl">@Model.TotalPages</a>
                    }

                    @if (Model.NextUrl is null)
                    {
                        <span class="page-btn" aria-disabled="true">Sonraki</span>
                    }
                    else
                    {
                        <a class="page-btn" href="@Model.NextUrl" rel="next">Sonraki</a>
                    }
                </nav>
            }
        }
    </div>
</section>
